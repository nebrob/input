{"version":3,"file":"input.module.js","sources":["../src/Vec2.js","../src/Input.js"],"sourcesContent":["export class Vec2 {\r\n    constructor(x = 0, y = 0) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n\r\n    /**\r\n     * Set members of the vector\r\n     *\r\n     * @param {number} x\r\n     * @param {number} y\r\n     */\r\n    set(x, y) {\r\n        this.x = x;\r\n        this.y = y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Assign members of the vector using another vector\r\n     *\r\n     * @param {Vec2} vec\r\n     */\r\n    assign(vec) {\r\n        this.x = vec.x;\r\n        this.y = vec.y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Clamp the vector to a min and a max vector\r\n     *\r\n     * @param {Vec2} min\r\n     * @param {Vec2} max\r\n     * @param {boolean} returnNew\r\n     */\r\n    clamp(min, max, returnNew = false) {\r\n        let clampedX = Math.max(Math.min(this.x, max.x), min.x);\r\n        let clampedY = Math.max(Math.min(this.y, max.y), min.y);\r\n        if (returnNew) {\r\n            return new Vec2(clampedX, clampedY);\r\n        } else {\r\n            this.set(clampedX, clampedY);\r\n\r\n            return this;\r\n        }\r\n    }\r\n\r\n    get length() {\r\n        return Math.sqrt(Math.pow(this.x, 2) + Math.pow(this.y, 2));\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {Vec2} other\r\n     */\r\n    distance(other){\r\n        return Math.sqrt(Math.pow(this.x - other.x, 2) + Math.pow(this.y - other.y, 2));\r\n    }\r\n}\r\n","import {EventEmitter} from \"tiny-events\";\r\nimport {Vec2} from \"./Vec2\";\r\n\r\n/**\r\n * Input helper class\r\n *\r\n * @fires Input#movestart\r\n * @fires Input#move\r\n * @fires Input#moveend\r\n * @fires Input#dragstart\r\n * @fires Input#drag\r\n * @fires Input#dragend\r\n */\r\nexport class Input extends EventEmitter {\r\n    /**\r\n     * Input Helper\r\n     *\r\n     * @param {HTMLElement} element\r\n     */\r\n    constructor(element, options = {}) {\r\n        super();\r\n        this.element = element;\r\n\r\n        this.draggingThreshold = options.draggingThreshold || 10;\r\n        this.damper = options.damper || 0.2;\r\n        this.damperVelocity = options.damperVelocity || 0.05;\r\n        this.friction = options.friction || 0.25;\r\n\r\n        this._shouldUpdate = false;\r\n        this._dragging = false;\r\n        this._isMoving = false;\r\n        this.threshold = 0.001;\r\n        this.lastUpdate = Date.now() / 1000 * 60;\r\n\r\n        this.min = new Vec2(0, 0);\r\n        this.max = new Vec2(element.offsetWidth, element.offsetHeight);\r\n        this.startPosition = new Vec2(0, 0);\r\n        this.endPosition = new Vec2(0, 0);\r\n        this.deltaPosition = new Vec2(0, 0);\r\n        this.deltaTarget = new Vec2(0, 0);\r\n        this.stoppingPosition = new Vec2(0, 0);\r\n        this.target = new Vec2(0, 0);\r\n        this.position = new Vec2(0, 0);\r\n        this.acceleration = new Vec2(0, 0);\r\n        this.direction = new Vec2(0, 0);\r\n        this.velocity = new Vec2(0, 0);\r\n    }\r\n\r\n    set dragging(state) {\r\n        if (state && !this.dragging) {\r\n            this._dragging = state;\r\n            this.emit('dragstart');\r\n        }\r\n        if (!state && this.dragging) {\r\n            this._dragging = state;\r\n            this.emit('dragend');\r\n        }\r\n    }\r\n\r\n    get dragging() {\r\n        return this._dragging;\r\n    }\r\n\r\n    get shouldUpdate() {\r\n        return this._shouldUpdate;\r\n    }\r\n\r\n    set shouldUpdate(state) {\r\n        if (!state) {\r\n            this._shouldUpdate = state;\r\n            window.cancelAnimationFrame(this._raf)\r\n        }\r\n        ;\r\n\r\n        if (state && !this.shouldUpdate) {\r\n            this._shouldUpdate = state;\r\n            this.update();\r\n        }\r\n    }\r\n\r\n    get isMoving() {\r\n        return this._isMoving;\r\n    }\r\n\r\n    set isMoving(state) {\r\n        if (state === this.isMoving) return;\r\n\r\n        if (state && !this.isMoving) {\r\n            this.emit('movestart');\r\n        }\r\n\r\n        if (!state && this.isMoving) {\r\n            this.emit('moveend');\r\n        }\r\n\r\n        this._isMoving = state;\r\n    }\r\n\r\n    update = () => {\r\n        if (this.shouldUpdate) this._raf = window.requestAnimationFrame(this.update);\r\n\r\n        const now = Date.now() / 1000 * 60;\r\n        const deltaTime = now - this.lastUpdate;\r\n        this.lastUpdate = now;\r\n\r\n        this.deltaPosition.set(\r\n            this.target.x - this.position.x,\r\n            this.target.y - this.position.y\r\n        );\r\n\r\n        this.direction.set(\r\n            this.deltaPosition.x > 0 ? 1 : this.deltaPosition.x < 0 ? -1 : this.direction.x,\r\n            this.deltaPosition.y > 0 ? 1 : this.deltaPosition.y < 0 ? -1 : this.direction.y\r\n        );\r\n\r\n        this.velocity.set(\r\n            this.deltaPosition.x / deltaTime,\r\n            this.deltaPosition.y / deltaTime\r\n        );\r\n\r\n        this.acceleration.set(\r\n            this.velocity.x / deltaTime,\r\n            this.velocity.y / deltaTime\r\n        );\r\n\r\n        let _damper;\r\n        if (this.dragging) {\r\n            _damper = 0.9;\r\n        } else {\r\n            _damper = this.damper;\r\n        }\r\n\r\n        if (Math.abs(this.position.x - this.target.x) <= this.threshold) {\r\n            this.position.x = this.target.x;\r\n        } else {\r\n            this.position.x += this.deltaPosition.x * _damper * deltaTime;\r\n        }\r\n\r\n        if (Math.abs(this.position.y - this.target.y) <= this.threshold) {\r\n            this.position.y = this.target.y;\r\n        } else {\r\n            this.position.y += this.deltaPosition.y * _damper * deltaTime;\r\n        }\r\n\r\n        if (this.position.distance(this.target) > 0) {\r\n            this.isMoving = true;\r\n        } else {\r\n            this.isMoving = false;\r\n        }\r\n    }\r\n\r\n    onStart = (evt) => {\r\n        const normalizedEvent = this.normalizeEvent(evt);\r\n        this.startPosition.set(normalizedEvent.x, normalizedEvent.y);\r\n        this.dragging = true;\r\n        this.shouldUpdate = true;\r\n    }\r\n\r\n    /**\r\n     * @param {TouchEvent} evt\r\n     */\r\n    onMove = (evt) => {\r\n        const normalizedEvent = this.normalizeEvent(evt);\r\n\r\n        if (this.dragging) {\r\n            this.target.set(normalizedEvent.x, normalizedEvent.y).clamp(this.min, this.max)\r\n            this.emit('drag');\r\n        }\r\n\r\n        this.emit('move');\r\n        this.shouldUpdate = true;\r\n    }\r\n\r\n    onEnd = () => {\r\n        this.stoppingPosition.set(\r\n            this.target.x + Math.pow(this.velocity.x, 2) / (2 * this.friction * 9.80) * this.direction.x,\r\n            this.target.y + Math.pow(this.velocity.y, 2) / (2 * this.friction * 9.80) * this.direction.y\r\n        );\r\n\r\n        this.target.assign(this.stoppingPosition).clamp(this.min, this.max);\r\n\r\n        this.dragging = false;\r\n    }\r\n\r\n    /**\r\n     * Normalize a mousevent or a touchevent\r\n     *\r\n     * @param {MouseEvent|TouchEvent} evt\r\n     */\r\n    normalizeEvent(evt) {\r\n        if (evt instanceof TouchEvent) {\r\n            return {\r\n                x: evt.touches[0].clientX,\r\n                y: evt.touches[0].clientY\r\n            }\r\n        } else if (evt instanceof MouseEvent) {\r\n            return {\r\n                x: evt.clientX,\r\n                y: evt.clientY\r\n            }\r\n        }\r\n    }\r\n\r\n    attach() {\r\n        this.element.addEventListener('touchstart', this.onStart, false);\r\n        this.element.addEventListener('touchmove', this.onMove, false);\r\n        this.element.addEventListener('touchend', this.onEnd, false);\r\n        this.element.addEventListener('mousedown', this.onStart, false);\r\n        this.element.addEventListener('mousemove', this.onMove, false);\r\n        this.element.addEventListener('mouseup', this.onEnd, false);\r\n    }\r\n\r\n    detach() {\r\n        this.element.removeEventListener('touchstart', this.onStart, false);\r\n        this.element.removeEventListener('touchmove', this.onMove, false);\r\n        this.element.removeEventListener('touchend', this.onEnd, false);\r\n        this.element.removeEventListener('mousedown', this.onStart, false);\r\n        this.element.removeEventListener('mousemove', this.onMove, false);\r\n        this.element.removeEventListener('mouseup', this.onEnd, false);\r\n    }\r\n}\r\n"],"names":["Vec2","x","y","this","set","assign","vec","clamp","min","max","returnNew","clampedX","Math","clampedY","distance","other","sqrt","pow","Input","element","options","_this","update","shouldUpdate","_raf","window","requestAnimationFrame","_damper","now","Date","deltaTime","lastUpdate","deltaPosition","target","position","direction","velocity","acceleration","dragging","damper","abs","threshold","isMoving","onStart","evt","normalizedEvent","normalizeEvent","startPosition","onMove","emit","onEnd","stoppingPosition","friction","draggingThreshold","damperVelocity","_shouldUpdate","_dragging","_isMoving","offsetWidth","offsetHeight","endPosition","deltaTarget","TouchEvent","touches","clientX","clientY","MouseEvent","attach","addEventListener","detach","removeEventListener","state","cancelAnimationFrame","EventEmitter"],"mappings":"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"}